kind: pipeline
name: default

steps:
- name: build
  image: docker
  commands:
  - cd web
  - docker build -t app:1.0 .

- name: web
  image: docker
  detach: true
  commands:
  - docker run app:1.0

- name: test
  image: python
  commands:
  - cd tests
  - pip install -r requirements.txt
  - pytest -vvv

- name: slack
  image: plugins/slack
  settings:
    webhook:
      from_secret: slack_webhook
    channel: ci
    template: >
      {{#success build.status}}
        build {{build.number}} succeeded. Good job. {{build.link}}
      {{else}}
        build {{build.number}} failed. Fix me please.
      {{/success}}
  when:
    status: [ success ]